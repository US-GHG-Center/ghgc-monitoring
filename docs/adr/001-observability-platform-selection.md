# Observability Platform Selection

- Status: draft
- Deciders: @alukach, @meghana-paramesh
- Date: 2023-11-02

## Context

This ADR will provide a recommendation for tooling to provide an observability platform to the administrators of the GHGC program. At time of writing, the GHGC infrastructure is configured to send logs to AWS CloudWatch and OpenTelemetry traces to AWS X-Ray.

## Criteria

### Self Hosted

In efforts to minimize complexities around billing requirements and data access from outside of our managed AWS environment, it is required that the solution will support self-hosting.

### Required Features

We anticipate that a full-featured observability platform would provide the following features:

- Metrics
- Traces
- Logs
- Alerts
- Dashboards

<details>

<summary>Summary of expected features...</summary>

#### Metrics

Metrics are quantitative measurements that provide a high-level overview of our system's health and performance. They are often aggregated and displayed in dashboards, showing metrics such as CPU usage, memory utilization, request response times, and error rates.

##### Value

- Early Detection: Metrics help us detect performance issues, bottlenecks, and anomalies before they impact the user experience, allowing for proactive responses.
- Performance Optimization: Metrics enable us to fine-tune and optimize our system resources, leading to cost savings and improved user satisfaction.
- Capacity Planning: With historical metric data, we can make informed decisions about scaling our infrastructure to handle future loads.

#### Traces

Traces provide detailed insights into the flow of requests and transactions as they traverse through our system. Distributed tracing can help us understand how different components of our system interact and impact each other.

##### Value

- Troubleshooting: Traces assist us in identifying the root cause of performance issues, bottlenecks, and latency problems by visualizing the complete request path.
- Service Dependencies: Trace data helps us map out dependencies between services, making it easier to pinpoint issues in our microservices architecture.
- Profiling: Traces enable profiling and in-depth analysis of requests, helping us optimize specific parts of our application.

#### Logs

Logs are textual or structured records of events, errors, and activities within our system, providing detailed context about what's happening in our applications and infrastructure.

##### Value

- Debugging: Logs are essential for debugging issues in production systems, allowing us to trace the sequence of events and pinpoint errors or unexpected behavior.
- Incident Response: Logs are invaluable in incident response and post-mortem analysis, helping us understand what led to an incident and how to prevent similar ones in the future.

#### Alerts

Alerts are notifications triggered when predefined conditions or thresholds are met. These conditions can be based on metrics, traces, or log data and are essential for proactively managing our system.

##### Value

- Real-time Monitoring: Alerts provide real-time notifications of critical events or issues, enabling us to respond rapidly to potential problems.
- Incident Management: Alerts assist in incident management by notifying the right people or teams when something goes wrong, helping to minimize downtime and impact.

</details>

### Operational Burden

Operational burden refers to the overhead and maintenance required to set up and manage the observability platform. It is important to assess the platform's ease of deployment, scalability, and ongoing management. A platform with a high operational burden may require significant resources, impacting the project team's productivity.

#### Considerations

- How easy is it to host the platform?
- How easy is it to set up the platform?
- How mature is the technology?
- What is the level of community support for the platform?
- Can it be integrated seamlessly into the project's existing infrastructure?

### Cost

Given that we primarily focus on self-hosted solutions, costs largely pertain to costs associated with the cloud infrastructure necessary to host the observability platform.

#### Considerations

- What is the estimated cost for the compute resources & data storage required when operating the platform?
- Are there additional costs for data retention, data transfer, or associated AWS services?

### Future Proof

Future-proofing involves assessing whether the observability platform can adapt to evolving technology and organizational needs.

#### Considerations

- Does the platform support a wide range of data sources and integrations?
- Can it handle the increasing volume and complexity of data generated by the project's systems?

## Considered Solutions

There are many commercial off-the-shelf solutions capable of providing an observability platform for our needs.

- AWS Solutions: [CloudWatch](https://aws.amazon.com/cloudwatch/), [X-Ray](https://aws.amazon.com/xray/)
- [SigNoz](https://signoz.io/)
- [Grafana](https://grafana.com/)

### Not Considered

- [New Relic](https://newrelic.com/)
- [Datadog](https://www.datadoghq.com/)

While the above solutions are popular and appear full-feature, they were not thoroughly investigated due to their apparent lack of self-hosting options. If commercial SaaS-based solutions are to be considered, these tools should be reviewed in-depth.

### AWS Solutions: CloudWatch + X-Ray

AWS CloudWatch is a comprehensive monitoring and observability service for AWS resources and applications. It can collect and track metrics, collect and monitor log files, and set alarms. For observability, CloudWatch can provide valuable insights into the project's AWS infrastructure and applications by offering metrics and logs.

AWS X-Ray is a distributed tracing service that helps you analyze and trace requests as they travel through the project's application. It can track the flow of requests across microservices and provide detailed insights into the performance of each component. X-Ray is essential for diagnosing issues in complex, distributed architectures.

#### Use for Observability

By integrating CloudWatch and X-Ray, you can gain a holistic view of the project's AWS-based applications. CloudWatch provides metrics and logs for AWS resources, while X-Ray offers distributed tracing for application-level observability. Together, they enable you to monitor, troubleshoot, and optimize the performance of the project's applications running in the AWS cloud.

#### Review

We are currently using CloudWatch and X-Ray to store logs, metrics, and traces for our applications. They operate on a pay-per-usage model and are generally very cost-effective.

| Criteria                | ✅ / ❌ | Notes |
| ----------------------- | ------- | ----- |
| **Expected Features**   |         |       |
| Metrics                 |         |       |
| Traces                  |         |       |
| Logs                    |         |       |
| Alerts                  |         |       |
| Dashboards              |         |       |
| Security                |         |       |
| **Operational Burden**  |         |       |
| Ease of Hosting         |         |       |
| Ease of Configuration   |         |       |
| Product Maturity        |         |       |
| Community Support       |         |       |
| Integration             |         |       |
| **Cost**                |         |       |
| Compute & Storage Costs |         |       |
| Additional Costs        |         |       |
| **Future Proof**        |         |       |
| Data Source Support     |         |       |
| Scalability             |         |       |

#### Shortcomings

Being that CloudWatch and X-Ray are AWS services, they require that viewers have AWS credentials. Obtaining these credentials can be challenging, particularly for MCP deployments.

### SigNoz

SigNoz is an open-source application performance monitoring and observability platform. It is designed for microservices architectures and cloud-native environments. SigNoz provides distributed tracing, metrics, and logs.

#### Use for Observability

SigNoz allows you to gain deep insights into the behavior of the project's microservices and analyze request flows. It can help you troubleshoot issues, optimize performance, and identify latency bottlenecks within the project's distributed systems. Being open-source, it provides flexibility and can be tailored to the project's specific needs.

#### Review

SigNoz' strength appears to be it's support for Kubernetes clusters and having an ability to immediately monitor the health of a Kubernetes ecosystem. As it is designed for a containerized environment, it comes feature complete with a storage backend to store metrics, logs, and traces. The value of this to the GHGC program is minimial as we do not use Kubernetes and we are already equipped with a system to store logs and metrics (AWS CloudWatch) and traces (AWS X-Ray). While the project is impressive and well thought out, at times it did not feel like all features were fully developed and lead the reviewers to predict that it likely does not have a large full-time technical team dedicated to the development of the project.

| Criteria                | ✅ / ❌ | Notes                                                                                                                                                                                                                                                        |
| ----------------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Expected Features**   |         |                                                                                                                                                                                                                                                              |
| Metrics                 | ✅      |                                                                                                                                                                                                                                                              |
| Traces                  | ✅      |                                                                                                                                                                                                                                                              |
| Logs                    | ✅      |                                                                                                                                                                                                                                                              |
| Alerts                  | ✅      |                                                                                                                                                                                                                                                              |
| Dashboards              | ✅      |                                                                                                                                                                                                                                                              |
| Security                |   ✅   | |
| **Operational Burden**  |         |                                                                                                                                                                                                                                                              |
| Ease of Hosting         | ❌      | Involves various services (Clickhouse, Frontend, ZooKeeper, etc). Primarily focused on Kubernetes deployments, which is not of use to us. Would require us to stray from typical path.                                                                       |
| Ease of Configuration   | -       | Only tested with demo datasources.                                                                                                                                                                                                                           |
| Product Maturity        | ❌      | Currently on version `0.33.1`, ~3 years old                                                                                                                                                                                                                  |
| Community Support       | ✅      | 15k+ starts on GitHub                                                                                                                                                                                                                                        |
| Integration             | ❌      | Would require us to point OTEL logs at new endpoint, but generally supports the receiving of logs. Signoz may offer fewer out-of-the-box features compared to some commercial APM solutions. You may need to invest more effort in customization and integration to achieve the desired functionality.                                                                                                                                                               |
| **Cost**                |         |                                                                                                                                                                                                                                                              |
| Compute & Storage Costs | ❌      | Costs associated with managing Clickhouse and other infrastructure anticipated to be non-trivial. In-depth research into cost estimations was not performed due to time constraints.                                                                         |
| Additional Costs        | ✅      | None foreseen                                                                                                                                                                                                                                                |
| **Future Proof**        |         |                                                                                                                                                                                                                                                              |
| Data Source Support     | ❌      |                                                                                                                                                                                                                                                              |
| Scalability             | ❌      | While SigNoz' datastore backend (Clickhouse) advertises extensive scalability, this is something that would need to be managed by our own development team and is a tool that is unfamiliar to the development team and poses as a potential risk/challenge. |

### Grafana

Grafana is an open-source monitoring and observability platform known for its powerful visualization and dashboarding capabilities. While Grafana itself doesn't collect observability data, it can integrate with various data sources, including metrics, logs, and traces, to create unified dashboards.

- [Grafana Open Source](https://grafana.com/oss/grafana/)
- [Grafana Enterprise](https://grafana.com/products/enterprise/)
- [Grafana Cloud](https://grafana.com/products/cloud/)

#### Use for Observability

Grafana is excellent for creating customized dashboards that aggregate data from different observability tools and sources. It acts as a central hub for visualizing and analyzing metrics, logs, and traces, making it a valuable part of the project's observability stack when used in conjunction with other tools.

#### Review

| Criteria                | ✅ / ❌ | Notes                                                                                                                                                                                                                                                                                 |
| ----------------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Expected Features**   |         |                                                                                                                                                                                                                                                                                       |
| Metrics                 | ✅      |                                                                                                                                                                                                                                                                                       |
| Traces                  | ✅      |                                                                                                                                                                                                                                                                                       |
| Logs                    | ✅      |                                                                                                                                                                                                                                                                                       |
| Alerts                  | ✅      | The alerting mechanisms is sophisticated.                                                                                                                                                                                                                                             |
| Dashboards              | ✅      | Grafana is renowned for its powerful visualization capabilities. It offers a wide range of visualization options and plugins, making it an excellent choice for creating custom dashboards and reports. You can create visually appealing and informative charts, graphs, and tables. |
| Security                | ✅      | Direct control over the security measures and policies applied to your Grafana instance, which can be crucial for sensitive data.    |
| **Operational Burden**  |         |                                                                                                                                                                                                                                                                                       |
| Ease of Hosting         | ✅      | Hosting Grafana appears to be as simple as running a single Docker image on ECS Fargate. Running the service within AWS allows for easy integration with other AWS services and resources, such as Amazon RDS, S3, and CloudWatch.                                                    |
| Ease of Configuration   | ❌      | While Grafana provides easy-to-install plugins for new data sources, the ability to explore data can feel overwhelming due to the level of fine-grained controls presented to the user.                                                                                               |
| Product Maturity        | ✅      | Grafana is widely adopted by organizations across various industries. Grafana has an extensive ecosystem of plugins and integrations, both official and community-contributed.                                                                                                        |
| Community Support       | ✅      | Grafana has a large and active user community, along with an extensive ecosystem of plugins and integrations. This means you can easily find community-contributed plugins and dashboards to extend its functionality and integrate with various data sources.                        |
| Integration             | ✅      | Grafana supports an impressive number of data sources, many of which we use today (AWS CloudWatch, AWS X-Ray, PostgreSQL). Setup of these data sources required little effort. The alerting tooling                                                                                                |
| **Cost**                |         |                                                                                                                                                                                                                                                                                       |
| Compute & Storage Costs |  ✅       |  Given that Grafana can reas from already-utilized services (CloudWatch, X-Ray), costs are primarily associated with operating Grafana application, which seems to be minimal.                                                                                                                                                                                                                  |
| Additional Costs        |   ✅      |  No additional costs foreseen.                                                                                                                                                                                                                                                                                     |
| **Future Proof**        |         |                                                                                                                                                                                                                                                                                       |
| Data Source Support     | ✅      | Extensive data source options                                                                                                                                                                                                                                                                                      |
| Scalability             | ✅        | Being that Grafana doesn't store the telemetry data itself, it is very scalable.                                                                                                                                                                                                                                                                   |

## Findings

We recommend continuing forward with Grafana. It seamlessly builds upon our existing tooling (AWS CloudWatch & X-Ray), is lightweight to host, anticipated to have minimal impact on current operational costs, and can be easily transitioned to a third-party hosted solution.
